# 2024년 AWS DeepRacer Championship 춘천
제2회 AWS DeepRacer Championship 춘천

```결승 진출```

## 공모 내용
 AWS DeepRacer를 활용한 인공지능 강화학습 기반의 자율주행 자동차 AI 융합 경진대회

## 대회 진행
### 트랙
#### 예선: Smile Speedway(Counterclockwise)  
![image](https://github.com/user-attachments/assets/d161e888-154e-4c00-9ed1-1a01d58de8a8)

#### 본선: 2022 re:Invent Championship(Counterclockwise)
![image](https://github.com/user-attachments/assets/3c56e19b-9998-4c72-afe8-24c2dc911885)

### 규칙
- 1바퀴 완주 기록 기준 (트랙 이탈 시 3초 패널티)   
- 모델 훈련시간 : 30시간  
- 모델 제출 제한 횟수 : 50회

### 예선
작년에 참가했던 2023년 인천 딥레이서 챔피언십에서 사용한 트랙 Smile Speedway와 같은 트랙이라 좀 더 수월할 것이라 예상하고 예선전에 임하였다.

하지만 예상과 달리 같은 코드와 파라미터, 조향각을 사용했음에도 좋은 랩타임이 나오지 않아 별도의 수정 과정을 거쳤다.

변경사항은 총 4가지로 코드 최적화, 코드 파라미터 수정, 조향각과 속도 수정, 하이퍼 파라미터 수정이다.

#### 코드 최적화) 
이전에 사용하던 코드는 여러 테스트들이 묶여 있어 현재 AWS 시스템에서 사용이 안되는 것을 확인하였다.

테스트 하는 부분은 실제 작동하는데 영향을 끼치지 않아 모두 삭제하였고 더 직관적인 코드를 구성할 수 있었다.

#### 코드 파라미터 수정)
훈련에 사용하는 보상함수 코드에는 다음과 같은 주요 세가지 파라미터 수정 포인트가 있다.

#### 1. get_target_point 함수의 r 값:
설정한 값: r = params['track_width'] * 0.45  
파라미터 설명: 이 반지름(r)은 차량의 위치를 기준으로 웨이포인트가 "안쪽" 또는 "바깥쪽"에 있는지 판단하는 데 사용된다. 이 값을 조정하면 차량이 트랙의 중앙선을 얼마나 가깝게 따라야 하는지를 변경할 수 있다.  

수정 포인트: 현재 0.45로 설정된 배수를 늘리거나 줄이면 트랙을 따르는 "밀도"가 바뀌게 된다. 더 큰 값은 차량이 트랙의 중앙을 더 가깝게 따르도록 하고, 더 작은 값은 차량이 더 느슨하게 트랙을 따르도록 할 수 있다.  

#### 2. up_sample 함수의 factor 값:
설정한 값: up_sample(waypoints, 20)  
설명: 이 factor는 추가한 최적좌표 웨이포인트 사이사이에 얼마나 더 많은 웨이포인트들을 추가할지를 제어한다. 더 높은 값은 기존 웨이포인트 사이에 더 많은 웨이포인트를 추가하여 경로 계획을 부드럽게 하지만 계산 부하가 증가한다.  

수정 포인트: 이 값을 조정하면 웨이포인트의 밀도가 변경된다. 더 높은 값은 차량이 경로를 더 부드럽게 따라가게 만들 수 있지만 계산 속도가 느려질 수 있다. 반대로 더 낮은 값은 덜 정밀하지만 계산이 더 빨라질 수 있다.  

#### 3. score_steer_to_point_ahead 함수의 오류 스케일링:
현재 수식: error = (steering_angle - best_steering_angle) / 60.0  
설명: 이 줄은 현재 조향 각도와 최적 조향 각도 간의 오차를 계산하며, 60.0으로 나누어 스케일링한다. 이 스케일링 값은 원하는 조향 각도에 대한 오류를 얼마나 크게 패널티로 처리할지를 결정한다.  

수정 포인트: 60.0을 다른 값으로 변경하면 조향 오류에 대한 보상 민감도가 조정된다. 더 작은 값을 사용하면 함수가 조향 오류에 대해 더 민감하게 반응하여 더 정확한 조향을 유도할 수 있고, 더 큰 값은 오류에 대해 더 관대하게 반응하게 됩니다.

이렇게 세가지 파라미터들을 설정한 조향각과 속도에 맞게 다양한 테스트 시나리오를 세워가면서 훈련을 했고 최적의 파라미터를 찾을 수 있었다.

#### 조향각과 속도 수정)
![image](https://github.com/user-attachments/assets/be43cd1c-3bec-4c74-bb64-b6b242f6a5b4)

훈련을 시작하면 훈련과 평가 과정을 거쳐서 보상함수 훈련 그래프가 형성이 된다.

그와 함께 차량의 주행 시뮬레이션 영상을 보여주는데 트랙의 어느 구간에서 이탈하는지 속도를 줄이는 구간은 어딘지를 명확히 확인할 수 있다.

이를 참고하면서 조향각과 속도를 수정하였다.

Smile Speedway 트랙은 비교적 쉬운 트랙이지만 굴곡이 큰 커브일 때와 반복되는 완만한 커브일 때를 모두 가지고 있기에 조향각 설정이 중요하다.

내가 사용하는 최적좌표 코드는 인코스를 타는 대신 트랙을 이탈할 확률이 높아지기 때문에 굴곡이 있는 커브일 시에는 속도를 확실히 낮추고 완만한 커브일 때는 굴곡 있는 커브일 때보다 최대속도를 높여 빠른 랩타임을 기록할 수 있도록 했다.

#### 하이퍼 파라미터 수정)
![image](https://github.com/user-attachments/assets/639d7f6b-fb26-4cf7-90d6-0286f8f59876)

하이퍼 파라미터 중 수정한 부분은 Entropy와 Discount factor이다. 

#### - Entropy:
  훈련을 할 때 더 다양한 행동을 할 수 있도록 해주는 장치로 큰 값을 설정할시 훈련을 진행할 때 더 많은 실험을 하게 된다. 많은 실험을 하면 더 다양한 행동을 할 수 있겠지만 훈련의 시간이 길어지고 완주율 또한 낮아질 수 있다.

  기본으로 설정된 값은 0.01로 조금 더 다양한 시도를 할 수 있도록 0.03으로 훈련을 시작했다.

  훈련한 모델을 clone하여 훈련 시간이 2시간을 넘어갈 때(한번 훈련 당 1시간을 잡고 3번째 훈련을 시작할 때) 0.003으로 극단적으로 값을 줄여 여태까지 훈련한 데이터를 기반으로 훈련할 수 있도록 설정했다.

  어느정도 훈련이 안정되면 더 이상의 다양한 시도를 하지 않는 것도 좋다고 판단한 결과이다.

#### - Discount factor:
  목표를 달성하는 데 걸리는 시간에 대해 얼마나 신경 쓰는지를 조정한다. 값을 크게 설정하면 장기적인 보상에 집중하고 낮게 설정하면 즉각적인 보상에 집중하게 된다.

  기본으로 설정된 값은 0.99로 훈련이 너무 장기화되지 않도록 0.7로 값을 줄여서 훈련을 진행하였다.

#### 예선 결과
![image](https://github.com/user-attachments/assets/c7784a68-880e-4a0b-aab7-c8472931506c)

랩타임 8.859의 기록을 세웠고 2등으로 예선을 마무리 지었다.

### 예선
